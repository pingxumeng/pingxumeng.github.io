---
layout: post
title: Thrift Guide
---
## What's thrift ?
From [Thrift Official WebSite](http://thrift.apache.org/)

>The Apache Thrift software framework, for scalable cross-language services development, combines a software stack with a code generation engine to build services that work efficiently and seamlessly between C++, Java, Python, PHP, Ruby, Erlang, Perl, Haskell, C#, Cocoa, JavaScript, Node.js, Smalltalk, OCaml and Delphi and other languages.
Thrift是一个可伸缩、跨语言的服务开发框架，thrift自带一个代码生成工具生成服务，服务在各种语言之间可以高效、无缝的衔接。

## how to cross language in thrift?
Thrift使用IDL(Interface Definition Language)来定义接口，接口是由Service和Type定义组成。IDL更多细节请参见http://thrift.apache.org/docs/idl [Thrift 白皮书](http://thrift.apache.org/static/files/thrift-20070401.pdf)。
Thrift可以根据Interface Definition生成各种语言的服务和类型。
## Thrift Architecture
Here is a pictorial view of the Thrift network stack:
![Thrift stack][1]

###Transport
 Transport为传输层的抽象，用来与网络层交互：从网络层传输或读取数据。TTransport接口定义的一些方法：
    * open
    * close
    * write(byte[] buffer)
    * int read(byte[] bytes, int i, int i1)
    * flush
    * peek
在Server端有一个ServiceTransport接口，顾名思义，用来在服务器端监听连接，和为客户端连接创建Transport对象。主要方法：
    * open
    * close
    * interrupt
    * listen()
    * TTransport accept()
Transport 的具体实现主要有：
    * TSocket，used for client.
    * TServerSocket，used for server side.

###Protocol
协议层主要用来与传输层交互，负责怎么把传输层的二进制数据翻译成内存中的数据接口以供程序使用。所以，Protocol的实现有XML,JSON,Binary,Compact,Plain text等。Protocol接口的主要方法：
	* writeMessageBegin(name, type, seq)
    * writeMessageEnd()
    * writeStructBegin(name)
    * writeStructEnd()
    * writeFieldBegin(name, type, id)
    * writeFieldEnd()
    * writeFieldStop()
    * writeMapBegin(ktype, vtype, size)
    * writeMapEnd()
    * writeListBegin(etype, size)
    * writeListEnd()
    * writeSetBegin(etype, size)
    * writeSetEnd()
    * writeBool(bool)
    * writeByte(byte)
    * writeI16(i16)
    * writeI32(i32)
    * writeI64(i64)
    * writeDouble(double)
    * writeString(string)
    还有对应的写方法，Protocol主要用来与传输层交互[Thrift中定义的数据结构](http://thrift.apache.org/docs/types)。
Thrift Protocols are stream oriented by design. There is no need for any explicit framing. For instance, it is not necessary to know the length of a string or the number of items in a list before we start serializing them.
    Thrift是面向流的，无需

### Proceccor
A Processor encapsulates the ability to read data from input streams and write to output streams. The input and output streams are represented by Protocol objects. The Processor interface is extremely simple:
```java
interface TProcessor {
    bool process(TProtocol in, TProtocol out) throws TException
}
```
Service-specific processor implementations are generated by the compiler. The Processor essentially reads data from the wire (using the input protocol), delegates processing to the handler (implemented by the user) and writes the response over the wire (using the output protocol).
###Server
A Server pulls together all of the various features described above:
1. Create a transport
2. Create input/output protocols for the transport
3. Create a processor based on the input/output protocols
4. Wait for incoming connections and hand them off to the processor